{% extends 'base.html' %}

{% block title %}Create Blog Post - AI Agent MVP{% endblock %}

{% block head %}
<style>
    /* Wizard Styles */
    .wizard-container {
        display: flex;
        flex-direction: column;
        width: 100%;
    }

    .wizard-progress {
        display: flex;
        justify-content: space-between;
        margin-bottom: 30px;
        position: relative;
    }

    .wizard-progress::before {
        content: '';
        position: absolute;
        top: 12px;
        left: 0;
        width: 100%;
        height: 2px;
        background-color: var(--gray-300);
        z-index: 1;
    }

    .progress-step {
        position: relative;
        z-index: 2;
        display: flex;
        flex-direction: column;
        align-items: center;
        flex: 1;
    }

    .step-bubble {
        width: 25px;
        height: 25px;
        border-radius: 50%;
        background-color: var(--gray-300);
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        color: white;
        margin-bottom: 10px;
        position: relative;
        transition: all 0.3s;
        border: 3px solid var(--body-bg);
    }

    .step-bubble i {
        font-size: 12px;
    }

    .step-label {
        font-size: 0.8rem;
        text-align: center;
        color: var(--gray-600);
        font-weight: 500;
        transition: all 0.3s;
    }

    .progress-step.active .step-bubble {
        background-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.25);
    }

    .progress-step.active .step-label {
        color: var(--primary-color);
        font-weight: 600;
    }

    .progress-step.completed .step-bubble {
        background-color: var(--success-color);
    }

    .wizard-step {
        display: none;
        animation: fadeEffect 0.5s;
    }

    .wizard-step.active {
        display: block;
    }

    @keyframes fadeEffect {
        from {
            opacity: 0;
            transform: translateY(10px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .wizard-buttons {
        display: flex;
        justify-content: space-between;
        margin-top: 30px;
        padding-top: 20px;
        border-top: 1px solid var(--border-color);
    }

    .wizard-progress-bar {
        height: 6px;
        background-color: var(--gray-200);
        border-radius: 3px;
        margin: 20px 0;
        overflow: hidden;
    }

    .progress-fill {
        height: 100%;
        background-color: var(--primary-color);
        width: 0%;
        transition: width 0.5s ease;
    }

    /* Content Outline Styles */
    .outline-container {
        border: 1px solid var(--border-color);
        border-radius: 8px;
        padding: 20px;
        margin-top: 10px;
        background-color: var(--light-color);
    }

    .outline-section {
        margin-bottom: 15px;
        padding-bottom: 15px;
        border-bottom: 1px dashed var(--border-color);
    }

    .outline-section:last-child {
        border-bottom: none;
        margin-bottom: 0;
        padding-bottom: 0;
    }

    .outline-section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
    }

    .outline-section input {
        font-weight: 600;
        background-color: transparent;
        border: 1px solid transparent;
        border-radius: 4px;
        padding: 5px 10px;
        width: 100%;
    }

    .outline-section input:focus {
        border-color: var(--primary-color);
        background-color: white;
    }

    .outline-actions {
        display: flex;
        gap: 5px;
    }

    .outline-actions button {
        background: none;
        border: none;
        font-size: 16px;
        cursor: pointer;
        color: var(--gray-600);
        transition: color 0.2s;
    }

    .outline-actions button:hover {
        color: var(--primary-color);
    }

    .add-outline-section {
        display: flex;
        align-items: center;
        gap: 10px;
        color: var(--primary-color);
        background: none;
        border: 1px dashed var(--primary-color);
        padding: 10px;
        border-radius: 4px;
        width: 100%;
        justify-content: center;
        cursor: pointer;
        transition: all 0.2s;
    }

    .add-outline-section:hover {
        background-color: rgba(0, 123, 255, 0.05);
    }

    /* SEO Section Styles */
    .seo-metrics {
        display: flex;
        gap: 20px;
        margin-top: 15px;
    }

    .seo-metric {
        flex: 1;
        padding: 15px;
        border-radius: 8px;
        text-align: center;
    }

    .seo-metric.good {
        background-color: rgba(40, 167, 69, 0.1);
        border: 1px solid rgba(40, 167, 69, 0.3);
    }

    .seo-metric.warning {
        background-color: rgba(255, 193, 7, 0.1);
        border: 1px solid rgba(255, 193, 7, 0.3);
    }

    .seo-metric.bad {
        background-color: rgba(220, 53, 69, 0.1);
        border: 1px solid rgba(220, 53, 69, 0.3);
    }

    .keyword-tags {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        margin-top: 10px;
    }

    .keyword-tag {
        background-color: var(--light-color);
        border: 1px solid var(--border-color);
        border-radius: 20px;
        padding: 5px 12px;
        font-size: 0.875rem;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .keyword-tag button {
        background: none;
        border: none;
        font-size: 14px;
        cursor: pointer;
        color: var(--gray-600);
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 0;
    }

    /* Target Audience Styles */
    .audience-options {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
        gap: 15px;
        margin-top: 15px;
    }

    .audience-option {
        border: 1px solid var(--border-color);
        border-radius: 8px;
        padding: 15px;
        cursor: pointer;
        transition: all 0.2s;
    }

    .audience-option.selected {
        border-color: var(--primary-color);
        background-color: rgba(0, 123, 255, 0.05);
    }

    .audience-option h4 {
        margin-bottom: 5px;
        font-size: 1rem;
    }

    .audience-option p {
        font-size: 0.875rem;
        color: var(--gray-600);
        margin: 0;
    }

    /* Autosave indicator */
    .autosave-indicator {
        position: fixed;
        bottom: 20px;
        right: 20px;
        background-color: rgba(33, 37, 41, 0.85);
        color: white;
        padding: 8px 15px;
        border-radius: 4px;
        font-size: 0.875rem;
        display: flex;
        align-items: center;
        gap: 8px;
        z-index: 1000;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        opacity: 0;
        transition: opacity 0.3s;
    }

    .autosave-indicator.visible {
        opacity: 1;
    }

    .autosave-indicator .spinner {
        border: 2px solid rgba(255, 255, 255, 0.2);
        border-left-color: white;
        width: 16px;
        height: 16px;
    }

    /* Content purpose styles */
    .purpose-options {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: 15px;
        margin-top: 15px;
    }

    .purpose-option {
        border: 1px solid var(--border-color);
        border-radius: 8px;
        padding: 15px;
        cursor: pointer;
        transition: all 0.2s;
    }

    .purpose-option.selected {
        border-color: var(--primary-color);
        background-color: rgba(0, 123, 255, 0.05);
    }

    .purpose-option h4 {
        margin-bottom: 5px;
        font-size: 1rem;
    }

    .purpose-option p {
        font-size: 0.875rem;
        color: var(--gray-600);
        margin: 0;
    }

    /* Content Editor Styles */
    .content-editor {
        display: flex;
        flex-direction: column;
        gap: 20px;
    }

    .content-editor-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .editor-section {
        border: 1px solid var(--border-color);
        border-radius: 8px;
        overflow: hidden;
    }

    .editor-section-header {
        background-color: var(--light-color);
        border-bottom: 1px solid var(--border-color);
        padding: 10px 15px;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }

    .editor-section-title {
        font-weight: 600;
        margin: 0;
    }

    .editor-section-content {
        padding: 15px;
    }

    .spinner-large {
        width: 48px;
        height: 48px;
        border-width: 5px;
    }

    /* Responsive adjustments */
    @media (max-width: 768px) {
        .wizard-progress {
            flex-direction: column;
            gap: 10px;
            align-items: flex-start;
        }
        
        .wizard-progress::before {
            display: none;
        }
        
        .progress-step {
            flex-direction: row;
            width: 100%;
            gap: 10px;
        }
        
        .step-label {
            text-align: left;
        }
        
        .seo-metrics,
        .audience-options,
        .purpose-options {
            grid-template-columns: 1fr;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="page-header">
    <h1>Create Blog Post</h1>
    <p>Follow the steps below to create and optimize your blog post.</p>
</div>

<section class="card">
    <div class="wizard-container">
        <!-- Progress Tracker -->
        <div class="wizard-progress">
            <div class="progress-step active" data-step="1">
                <div class="step-bubble">1</div>
                <div class="step-label">Basic Information</div>
            </div>
            <div class="progress-step" data-step="2">
                <div class="step-bubble">2</div>
                <div class="step-label">Target Audience</div>
            </div>
            <div class="progress-step" data-step="3">
                <div class="step-bubble">3</div>
                <div class="step-label">Create Outline</div>
            </div>
            <div class="progress-step" data-step="4">
                <div class="step-bubble">4</div>
                <div class="step-label">Generate Content</div>
            </div>
            <div class="progress-step" data-step="5">
                <div class="step-bubble">5</div>
                <div class="step-label">SEO Optimization</div>
            </div>
        </div>

        <div class="wizard-progress-bar">
            <div class="progress-fill" style="width: 20%;"></div>
        </div>

        <form id="blog-wizard-form" method="post" action="{{ url_for('blog.create_post') }}">
            <!-- Step 1: Basic Information -->
            <div class="wizard-step active" data-step="1">
                <h2>Basic Information</h2>
                <p>Let's start by defining the core details of your blog post.</p>

                <div class="form-group">
                    <label for="title">Blog Title <span class="required">*</span></label>
                    <input type="text" id="title" name="title" placeholder="Enter a title for your blog post" required>
                    <small>A catchy title helps engage readers (50-60 characters recommended)</small>
                </div>

                <div class="form-group">
                    <label for="topic">Topic <span class="required">*</span></label>
                    <input type="text" id="topic" name="topic" placeholder="What is your blog post about?" required>
                    <small>Be specific about what you want your blog to cover</small>
                </div>

                <div class="form-group">
                    <label>Content Purpose</label>
                    <div class="purpose-options">
                        <div class="purpose-option" data-purpose="informative">
                            <h4>Informative</h4>
                            <p>Educate your audience about a topic, concept, or process</p>
                        </div>
                        <div class="purpose-option" data-purpose="persuasive">
                            <h4>Persuasive</h4>
                            <p>Convince readers about a particular viewpoint or action</p>
                        </div>
                        <div class="purpose-option" data-purpose="entertaining">
                        <div class="purpose-option" data-purpose="entertaining">
                            <h4>Entertaining</h4>
                            <p>Engage readers with stories, humor, or interesting content</p>
                        </div>
                        <div class="purpose-option" data-purpose="instructional">
                            <h4>Instructional</h4>
                            <p>Provide step-by-step guidance on how to accomplish something</p>
                        </div>
                        <div class="purpose-option" data-purpose="analytical">
                            <h4>Analytical</h4>
                            <p>Analyze trends, data, or findings about a particular subject</p>
                        </div>
                    </div>
                    <input type="hidden" name="content_purpose" id="content_purpose">
                </div>

                <div class="form-group">
                    <label for="tone">Tone</label>
                    <select id="tone" name="tone">
                        <option value="professional">Professional</option>
                        <option value="casual">Casual</option>
                        <option value="formal">Formal</option>
                        <option value="informative">Informative</option>
                        <option value="enthusiastic">Enthusiastic</option>
                        <option value="humorous">Humorous</option>
                        <option value="inspirational">Inspirational</option>
                        <option value="authoritative">Authoritative</option>
                    </select>
                    <small>The tone affects how your content is presented to readers</small>
                </div>
            </div>

            <!-- Step 2: Target Audience -->
            <div class="wizard-step" data-step="2">
                <h2>Target Audience</h2>
                <p>Define who your blog post is targeting to create more relevant content.</p>

                <div class="form-group">
                    <label>Who is your primary audience?</label>
                    <div class="audience-options">
                        <div class="audience-option" data-audience="beginners">
                            <h4>Beginners</h4>
                            <p>People new to the topic with little background knowledge</p>
                        </div>
                        <div class="audience-option" data-audience="intermediate">
                            <h4>Intermediate</h4>
                            <p>People with some knowledge looking to expand their understanding</p>
                        </div>
                        <div class="audience-option" data-audience="experts">
                            <h4>Experts</h4>
                            <p>Experienced individuals seeking advanced information</p>
                        </div>
                        <div class="audience-option" data-audience="professionals">
                            <h4>Professionals</h4>
                            <p>People who work in related fields or industries</p>
                        </div>
                        <div class="audience-option" data-audience="students">
                            <h4>Students</h4>
                            <p>People in academic settings looking for educational content</p>
                        </div>
                        <div class="audience-option" data-audience="general">
                            <h4>General Public</h4>
                            <p>A broad audience with varying levels of familiarity</p>
                        </div>
                    </div>
                    <input type="hidden" name="target_audience" id="target_audience">
                </div>

                <div class="form-group">
                    <label for="audience_details">Additional Audience Details (Optional)</label>
                    <textarea id="audience_details" name="audience_details" placeholder="Describe your audience in more detail (age range, interests, pain points, etc.)"></textarea>
                    <small>More specific audience details help create more targeted content</small>
                </div>
            </div>

            <!-- Step 3: Create Outline -->
            <div class="wizard-step" data-step="3">
                <h2>Content Outline</h2>
                <p>Define the structure of your blog post with an outline. Use AI to generate a suggested structure or create your own.</p>

                <div class="form-group">
                    <button type="button" id="generate-outline" class="btn primary">Generate Outline</button>
                    <div id="outline-loading" class="loading-spinner" style="display: none;">
                        <div class="spinner"></div>
                        <p>Generating outline... This may take a moment.</p>
                    </div>
                </div>

                <div class="form-group">
                    <label>Content Outline</label>
                    <div id="outline-container" class="outline-container">
                        <div class="outline-section" data-section-id="introduction">
                            <div class="outline-section-header">
                                <input type="text" placeholder="Introduction" value="Introduction">
                                <div class="outline-actions">
                                    <button type="button" class="move-section-up">↑</button>
                                    <button type="button" class="move-section-down">↓</button>
                                    <button type="button" class="delete-section">×</button>
                                </div>
                            </div>
                            <textarea placeholder="Describe what this section should cover..."></textarea>
                        </div>
                        <div class="outline-section" data-section-id="section-1">
                            <div class="outline-section-header">
                                <input type="text" placeholder="Section Title" value="Main Point 1">
                                <div class="outline-actions">
                                    <button type="button" class="move-section-up">↑</button>
                                    <button type="button" class="move-section-down">↓</button>
                                    <button type="button" class="delete-section">×</button>
                                </div>
                            </div>
                            <textarea placeholder="Describe what this section should cover..."></textarea>
                        </div>
                        <div class="outline-section" data-section-id="conclusion">
                            <div class="outline-section-header">
                                <input type="text" placeholder="Conclusion" value="Conclusion">
                                <div class="outline-actions">
                                    <button type="button" class="move-section-up">↑</button>
                                    <button type="button" class="move-section-down">↓</button>
                                    <button type="button" class="delete-section">×</button>
                                </div>
                            </div>
                            <textarea placeholder="Describe what this section should cover..."></textarea>
                        </div>
                    </div>
                    <button type="button" class="add-outline-section" id="add-section">
                        <span>+</span> Add Section
                    </button>
                    <input type="hidden" name="outline_json" id="outline_json">
                </div>
            </div>

            <!-- Step 4: Generate Content -->
            <div class="wizard-step" data-step="4">
                <h2>Generate Content</h2>
                <p>Generate your blog post content based on your outline. You can generate the entire post or section by section.</p>

                <div class="form-group">
                    <div class="content-editor-header">
                        <h3>Blog Content</h3>
                        <div>
                            <button type="button" id="generate-all-content" class="btn primary">Generate All Content</button>
                            <button type="button" id="generate-options" class="btn">Generation Options</button>
                        </div>
                    </div>
                    
                    <div id="content-editor" class="content-editor">
                        <div class="editor-section" data-section-id="introduction">
                            <div class="editor-section-header">
                                <h4 class="editor-section-title">Introduction</h4>
                                <button type="button" class="btn small generate-section">Generate</button>
                            </div>
                            <div class="editor-section-content">
                                <textarea placeholder="Your introduction goes here..."></textarea>
                            </div>
                        </div>
                        
                        <!-- Additional sections will be generated based on outline -->
                        
                        <div class="editor-section" data-section-id="conclusion">
                            <div class="editor-section-header">
                                <h4 class="editor-section-title">Conclusion</h4>
                                <button type="button" class="btn small generate-section">Generate</button>
                            </div>
                            <div class="editor-section-content">
                                <textarea placeholder="Your conclusion goes here..."></textarea>
                            </div>
                        </div>
                    </div>
                    
                    <div id="content-loading" class="loading-spinner" style="display: none; justify-content: center; padding: 30px 0;">
                        <div class="spinner spinner-large"></div>
                        <p>Generating content... This may take a minute.</p>
                    </div>
                    
                    <input type="hidden" name="content" id="content">
                </div>
                
                <div class="form-group">
                    <label for="length">Content Length</label>
                    <select id="length" name="length">
                        <option value="short">Short (~300 words)</option>
                        <option value="medium" selected>Medium (~600 words)</option>
                        <option value="long">Long (~1200 words)</option>
                        <option value="comprehensive">Comprehensive (~2000 words)</option>
                    </select>
                    <small>Longer posts typically provide more in-depth information</small>
                </div>
            </div>

            <!-- Step 5: SEO Optimization -->
            <div class="wizard-step" data-step="5">
                <h2>SEO Optimization</h2>
                <p>Optimize your blog post for search engines to improve visibility and reach.</p>

                <div class="form-group">
                    <label for="meta_title">Meta Title</label>
                    <input type="text" id="meta_title" name="meta_title" maxlength="60">
                    <small>Keep meta title under 60 characters. <span id="meta-title-count">0</span>/60 characters</small>
                </div>

                <div class="form-group">
                    <label for="meta_description">Meta Description</label>
                    <textarea id="meta_description" name="meta_description" maxlength="160"></textarea>
                    <small>Keep meta description under 160 characters. <span id="meta-desc-count">0</span>/160 characters</small>
                </div>

                <div class="form-group">
                    <label for="focus_keyword">Focus Keyword</label>
                    <input type="text" id="focus_keyword" name="focus_keyword" placeholder="Main keyword for SEO">
                    <small>The primary keyword you want to rank for</small>
                </div>

                <div class="form-group">
                    <label for="secondary_keywords">Secondary Keywords</label>
                    <input type="text" id="secondary_keywords" name="secondary_keywords" placeholder="Comma-separated list of related keywords">
                    <div class="keyword-tags" id="keyword-tags">
                        <!-- Keywords will be displayed here as tags -->
                    </div>
                    <small>Secondary keywords to improve SEO and topic coverage</small>
                </div>

                <div class="form-group">
                    <label for="slug">URL Slug</label>
                    <input type="text" id="slug" name="slug" placeholder="your-post-url">
                    <small>The URL path for your post. Use hyphens to separate words.</small>
                </div>

                <div class="form-group">
                    <button type="button" id="analyze-seo" class="btn primary">Analyze SEO</button>
                    <div id="seo-loading" class="loading-spinner" style="display: none;">
                        <div class="spinner"></div>
                        <p>Analyzing SEO... This may take a moment.</p>
                    </div>
                </div>

                <div class="seo-metrics" id="seo-metrics" style="display: none;">
                    <div class="seo-metric" id="seo-score">
                        <h4>SEO Score</h4>
                        <div class="score">0/100</div>
                    </div>
                    <div class="seo-metric" id="readability-score">
                        <h4>Readability</h4>
                        <div class="score">0/100</div>
                    </div>
                    <div class="seo-metric" id="keyword-density">
                        <h4>Keyword Density</h4>
                        <div class="score">0%</div>
                    </div>
                </div>
            </div>

            <!-- Wizard Navigation Buttons -->
            <div class="wizard-buttons">
                <button type="button" id="prev-step" class="btn" disabled>Previous</button>
                <button type="button" id="next-step" class="btn primary">Next</button>
                <button type="submit" id="submit-post" class="btn primary" style="display: none;">Save & Publish</button>
            </div>
        </form>
    </div>
</section>

<!--
